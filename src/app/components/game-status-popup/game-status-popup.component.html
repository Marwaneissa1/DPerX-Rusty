<div class="popup-backdrop" (click)="onClose()"></div>
<div class="game-status-popup glass-strong" (click)="$event.stopPropagation()">
    <div class="popup-header">
        <h3>Game Status</h3>
        <button class="close-btn" (click)="onClose()" type="button">
            <svg width="16" height="16" viewBox="0 0 12 12">
                <path d="M0 0L12 12M12 0L0 12" stroke="currentColor" stroke-width="1.5" />
            </svg>
        </button>
    </div>

    <div class="popup-content">
        @if (gameStatus) {
            <div class="status-grid">
                <div class="status-item">
                    <span class="status-label">Local Player ID</span>
                    <span class="status-value">{{ gameStatus.local_player_id }}</span>
                </div>

                <div class="status-item">
                    <span class="status-label">Online Players</span>
                    <span class="status-value">{{ gameStatus.online_players }}</span>
                </div>

                <div class="status-item">
                    <span class="status-label">Player Position</span>
                    <span class="status-value"
                        >X: {{ gameStatus.player_pos.x.toFixed(2) }}, Y: {{ gameStatus.player_pos.y.toFixed(2) }}</span
                    >
                </div>

                <div class="status-item">
                    <span class="status-label">Aim Screen</span>
                    <span class="status-value"
                        >X: {{ gameStatus.aim_screen.x.toFixed(2) }}, Y: {{ gameStatus.aim_screen.y.toFixed(2) }}</span
                    >
                </div>

                <div class="status-item">
                    <span class="status-label">Aim World</span>
                    <span class="status-value"
                        >X: {{ gameStatus.aim_world.x.toFixed(2) }}, Y: {{ gameStatus.aim_world.y.toFixed(2) }}</span
                    >
                </div>
            </div>

            <div class="players-section">
                <h3>Players ({{ gameStatus.players?.length || 0 }})</h3>
                <div class="players-list">
                    @for (player of gameStatus.players; track player.id) {
                        <div
                            class="player-item"
                            [class.expanded]="isPlayerExpanded(player.id)"
                            [class.local-player]="player.id === gameStatus.local_player_id"
                        >
                            <div class="player-header" (click)="togglePlayer(player.id)">
                                <span class="player-id">Player {{ player.id }}</span>
                                @if (player.id === gameStatus.local_player_id) {
                                    <span class="local-badge">YOU</span>
                                }
                                <span class="expand-icon">{{ isPlayerExpanded(player.id) ? "▼" : "▶" }}</span>
                            </div>
                            @if (isPlayerExpanded(player.id)) {
                                <div class="player-details">
                                    <div class="detail-row">
                                        <span class="detail-label">ID:</span>
                                        <span class="detail-value">{{ player?.id ?? "N/A" }}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Gametick:</span>
                                        <span class="detail-value">{{ player?.gametick ?? "N/A" }}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Position:</span>
                                        <span class="detail-value"
                                            >X: {{ player?.pos?.x?.toFixed(2) ?? "0.00" }}, Y:
                                            {{ player?.pos?.y?.toFixed(2) ?? "0.00" }}</span
                                        >
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Velocity:</span>
                                        <span class="detail-value"
                                            >X: {{ player?.vel?.x?.toFixed(2) ?? "0.00" }}, Y:
                                            {{ player?.vel?.y?.toFixed(2) ?? "0.00" }}</span
                                        >
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Frozen:</span>
                                        <span class="detail-value">{{ player?.frozen ?? false }}</span>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        } @else {
            <div class="loading">Loading game status...</div>
        }
    </div>
</div>
